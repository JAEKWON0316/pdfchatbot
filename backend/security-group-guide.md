# AWS EC2 보안 그룹 설정 가이드

## 1. EC2 인스턴스 생성 중 보안 그룹 설정

### 단계 1: 네트워크 설정 섹션에서

```
보안 그룹 생성 또는 선택
├── 새 보안 그룹 생성 (권장)
├── 보안 그룹 이름: pdfchatbot-sg
└── 설명: PDF Chatbot Backend Security Group
```

### 단계 2: 인바운드 보안 그룹 규칙

#### 규칙 1: SSH (필수)
```
┌─────────────────────────────────────────────────────────┐
│ 유형: SSH                                               │
│ 소스 유형: 내 IP (권장)                                 │
│ 소스: [자동으로 현재 IP 입력됨]                         │
│ 설명: SSH admin access                                  │
└─────────────────────────────────────────────────────────┘
```

#### 규칙 2: API 서버 (필수)
```
┌─────────────────────────────────────────────────────────┐
│ 유형: 사용자 지정 TCP                                   │
│ 포트: 3001                                              │
│ 소스 유형: 위치 무관                                    │
│ 소스: 0.0.0.0/0                                        │
│ 설명: PDF Chatbot API Server                           │
└─────────────────────────────────────────────────────────┘
```

#### 규칙 3: HTTP (선택사항)
```
┌─────────────────────────────────────────────────────────┐
│ 유형: HTTP                                              │
│ 소스 유형: 위치 무관                                    │
│ 소스: 0.0.0.0/0                                        │
│ 설명: Web server (optional)                            │
└─────────────────────────────────────────────────────────┘
```

#### 규칙 4: HTTPS (선택사항)
```
┌─────────────────────────────────────────────────────────┐
│ 유형: HTTPS                                             │
│ 소스 유형: 위치 무관                                    │
│ 소스: 0.0.0.0/0                                        │
│ 설명: SSL web server (optional)                        │
└─────────────────────────────────────────────────────────┘
```

## 2. 기존 인스턴스의 보안 그룹 수정

### AWS 콘솔에서 수정하기

1. **EC2 대시보드** → **인스턴스**
2. 인스턴스 선택 → **보안** 탭
3. **보안 그룹** 클릭
4. **인바운드 규칙 편집** 클릭
5. **규칙 추가** 버튼으로 새 규칙 추가

### CLI로 수정하기 (고급)

```bash
# 보안 그룹 ID 확인
aws ec2 describe-security-groups --group-names pdfchatbot-sg

# 3001 포트 추가
aws ec2 authorize-security-group-ingress \
    --group-id sg-xxxxxxxxx \
    --protocol tcp \
    --port 3001 \
    --cidr 0.0.0.0/0
```

## 3. 보안 수준별 권장 설정

### 🔒 개인 프로젝트 (최고 보안)
```
SSH (22): 내 IP만 (예: 123.456.789.0/32)
API (3001): 내 IP + Vercel IP 범위
HTTP/HTTPS: 필요시에만
```

### 👥 소규모 팀 (5명 미만)
```
SSH (22): 관리자 IP들만
API (3001): 0.0.0.0/0 (전체 허용)
HTTP/HTTPS: 필요시에만
```

### 🌐 공개 서비스
```
SSH (22): 관리자 IP들만 (절대 0.0.0.0/0 금지!)
API (3001): 0.0.0.0/0
HTTP (80): 0.0.0.0/0
HTTPS (443): 0.0.0.0/0
```

## 4. 보안 그룹 규칙 상세 설명

### 소스 유형 옵션

#### 내 IP (My IP)
- **설명**: 현재 접속 중인 IP 주소만 허용
- **형식**: 123.456.789.123/32
- **용도**: SSH 접속용 (가장 안전)
- **장점**: 최고 보안
- **단점**: IP가 바뀌면 접속 불가

#### 사용자 지정 (Custom)
- **설명**: 특정 IP 주소나 IP 범위 지정
- **형식**: 
  - 단일 IP: 123.456.789.123/32
  - IP 범위: 123.456.789.0/24
- **용도**: 특정 사용자들만 허용

#### 위치 무관 (Anywhere)
- **설명**: 모든 IP에서 접속 허용
- **형식**: 0.0.0.0/0
- **용도**: 공개 API, 웹 서버
- **주의**: SSH에는 절대 사용 금지!

#### 보안 그룹 (Security Group)
- **설명**: 다른 보안 그룹의 인스턴스만 허용
- **용도**: 내부 서비스 간 통신

## 5. 실제 설정 예시 (PDF 챗봇용)

### 최소 필수 설정
```
인바운드 규칙:
1. SSH | TCP | 22 | 내 IP | SSH 관리용
2. Custom TCP | TCP | 3001 | 0.0.0.0/0 | API 서버

아웃바운드 규칙:
- 모든 트래픽 허용 (기본값 유지)
```

### 완전한 설정 (웹서버 포함)
```
인바운드 규칙:
1. SSH | TCP | 22 | 내 IP | SSH 관리용
2. Custom TCP | TCP | 3001 | 0.0.0.0/0 | API 서버
3. HTTP | TCP | 80 | 0.0.0.0/0 | 웹 서버
4. HTTPS | TCP | 443 | 0.0.0.0/0 | SSL 웹 서버

아웃바운드 규칙:
- 모든 트래픽 허용 (기본값 유지)
```

## 6. 보안 그룹 관리 팁

### ✅ 좋은 관례
- SSH는 항상 특정 IP만 허용
- 규칙마다 명확한 설명 추가
- 불필요한 포트는 열지 않기
- 정기적으로 규칙 검토

### ❌ 피해야 할 것
- SSH에 0.0.0.0/0 사용
- 불필요한 포트 열기
- 설명 없는 규칙 생성
- 너무 넓은 IP 범위 허용

## 7. 문제 해결

### SSH 접속 안 됨
1. 보안 그룹에 SSH(22) 규칙 있는지 확인
2. 소스 IP가 현재 IP와 일치하는지 확인
3. 키 파일 권한 확인 (chmod 400)

### API 접속 안 됨
1. 3001 포트 규칙 있는지 확인
2. 소스가 0.0.0.0/0인지 확인
3. EC2 인스턴스 상태 확인

### IP 변경으로 접속 불가
1. AWS 콘솔에서 보안 그룹 수정
2. SSH 규칙의 소스 IP 업데이트
3. 또는 VPN 사용으로 고정 IP 확보